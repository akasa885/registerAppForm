providers:
  php:
    version: "8.2"

phases:
  install:
    cmds:
      # Install PHP extensions
      - docker-php-ext-install pdo_mysql bcmath mbstring exif pcntl gd zip \
        && pecl install redis \
        && docker-php-ext-enable redis \
        && apt-get clean && rm -rf /var/lib/apt/lists/*

  setup:
    cmds:
      - composer install --no-dev --optimize-autoloader
      - cp .env.example .env
      - php artisan key:generate
      - php artisan migrate --force

  build:
    cmds:
      # Optimize Laravel
      - php artisan config:clear
      - php artisan route:clear
      - php artisan cache:clear
      - php artisan config:cache
      - php artisan route:cache
      - php artisan view:cache